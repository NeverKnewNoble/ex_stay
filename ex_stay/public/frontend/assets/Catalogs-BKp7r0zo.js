var x=(l,e,a)=>new Promise((o,d)=>{var m=s=>{try{i(a.next(s))}catch(n){d(n)}},c=s=>{try{i(a.throw(s))}catch(n){d(n)}},i=s=>s.done?o(s.value):Promise.resolve(s.value).then(m,c);i((a=a.apply(l,e)).next())});import{r as u,M as N,c as F,_ as D,o as E,a as f,b as r,d as v,B as z,m as q,T as W,F as U,e as L,u as G,g as b,h as g,w as h,N as H,t as J,v as P,f as K,i as O}from"./index-Db7eiPIg.js";import{N as Q,F as X}from"./footer-jK3drDvy.js";import{l as Y}from"./listingCard-Bs5fFqiW.js";import{a as Z}from"./axios-Bn511Lua.js";import{s as B}from"./config-C47usz4h.js";function $(){const l=u([]),e=N({url:"frappe.client.get_list",params:{doctype:"Item",fields:["item_code","item_name","custom_property_category","custom_title","custom_property_description","custom_location","custom_city","custom_country","custom_profile_picture","custom_2nd_image","custom_3rd_image","custom_4th_image","custom_apartment_offers"],filters:{custom_is_ex_stay_property:1},limit_page_length:100}});return{properties:l,fetchProperties:()=>x(this,null,function*(){try{console.log("Fetching properties...");const o=yield e.fetch();if(console.log(o.data),Array.isArray(o)&&o.length>0){l.value=o;const d=l.value.map(s=>s.item_code);if(d.length===0){console.warn("âš ï¸ No item codes found, skipping price fetch.");return}console.log("Fetching Item Prices...");const c=yield N({url:"frappe.client.get_list",params:{doctype:"Item Price",filters:[["item_code","in",d]],fields:["item_code","price_list_rate","currency"]}}).fetch();console.log("âœ… Fetched Prices:",c);const i={};Array.isArray(c)&&c.forEach(s=>{i[s.item_code]={price_list_rate:s.price_list_rate,currency:s.currency}}),console.log("âœ… Price Mapping Dictionary:",i),l.value.forEach(s=>{var n,t;s.price_list_rate=((n=i[s.item_code])==null?void 0:n.price_list_rate)||null,s.currency=((t=i[s.item_code])==null?void 0:t.currency)||null})}else console.warn("âš ï¸ No properties found.")}catch(o){console.error("ðŸš¨ Unable to fetch properties:",o)}})}}function ee(){const l=u([]);return{countries:l,fetchCountries:()=>x(this,null,function*(){try{const a=yield Z.get(`${B}/api/method/ex_stay.api.countryList.countryInFrappe`);a.data.message&&a.data.message.data?(l.value=a.data.message.data,console.log("Fetched Countries:",l.value)):console.log("No countries found.")}catch(a){console.error("âŒ Error fetching countries:",a)}})}}function te(l){const e=u(1),a=u(8),o=u(""),d=u(""),m=u(""),c=u(""),i=u(""),s=u(""),n=u(""),t=u(""),_=F(()=>l.value.filter(p=>(!i.value||(p.custom_country||"").toLowerCase().includes(i.value.toLowerCase()))&&(!s.value||(p.custom_city||"").toLowerCase().trim().includes(s.value.toLowerCase().trim()))&&(!n.value||p.price_list_rate&&p.price_list_rate>=parseFloat(n.value))&&(!t.value||p.price_list_rate&&p.price_list_rate<=parseFloat(t.value)))),C=F(()=>{const p=(e.value-1)*a.value;return _.value.slice(p,p+a.value)}),w=F(()=>Math.max(1,Math.ceil(_.value.length/a.value))),y=()=>{i.value=o.value,s.value=d.value.trim(),n.value=m.value,t.value=c.value,e.value=1};return{page:e,perPage:a,tempSelectedCounty:o,tempCity:d,tempFromPrice:m,tempToPrice:c,selectedCounty:i,city:s,fromPrice:n,toPrice:t,filteredListings:_,paginatedListings:C,totalPages:w,applyFilters:y,resetFilter:()=>{o.value="",d.value="",m.value="",c.value="",y(),e.value=1}}}function oe(){return{getImageUrl:e=>e?e.startsWith("/files")?`${B}${e}`:e:"../assets/images/default-property.jpg"}}const re={name:"CatalogsPage",components:{NavBar:Q,FooterComponent:X,listingCard:Y},setup(){const l=G(),e=u(!1),{properties:a,fetchProperties:o}=$(),{countries:d,fetchCountries:m}=ee(),{page:c,perPage:i,tempSelectedCounty:s,tempCity:n,tempFromPrice:t,tempToPrice:_,selectedCounty:C,city:w,fromPrice:y,toPrice:k,filteredListings:p,paginatedListings:T,totalPages:A,applyFilters:I,resetFilter:M}=te(a),{getImageUrl:S}=oe(),j=()=>{e.value=!e.value},R=V=>{l.push({name:"BookingPage",query:{title:V.custom_title}})};return E(()=>x(this,null,function*(){yield o(),yield m()})),{showFilters:e,properties:a,countries:d,page:c,perPage:i,tempSelectedCounty:s,tempCity:n,tempFromPrice:t,tempToPrice:_,selectedCounty:C,city:w,fromPrice:y,toPrice:k,filteredListings:p,paginatedListings:T,totalPages:A,toggleFilters:j,applyFilters:I,resetFilter:M,getImageUrl:S,goToBookingPage:R}}},se={class:"w-full h-screen bg-gray-200 text-black relative"},ae={class:"w-full bg-white relative overflow-hidden px-[80px]"},le={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-[150px] z-50"},ie={class:"w-[90%] max-w-[800px] bg-gray-200 rounded-md shadow-lg p-6 relative"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},ce={class:"flex flex-col"},ue=["value"],de={class:"flex flex-col"},pe={class:"flex flex-col md:col-span-2 mt-2"},me={class:"grid grid-cols-2 gap-2"},ge={class:"flex flex-col"},fe={class:"flex flex-col"},_e={class:"flex justify-center md:justify-end mt-4"},ye={class:"w-full bg-white min-h-screen pt-10 px-6 sm:px-10 md:px-16 lg:px-[80px] pb-20 relative"},xe={key:0},ve={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 lg:gap-x-4"},be={class:"flex items-center justify-center pt-10"},he={key:1,class:"flex flex-col items-center justify-center min-h-[50vh] text-center"};function Ce(l,e,a,o,d,m){const c=b("NavBar"),i=b("listingCard"),s=b("n-pagination"),n=b("FooterComponent");return g(),f("div",se,[r("div",{class:z([l.isScrollingDown?"-translate-y-full":"translate-y-0","w-full transition-transform duration-500 ease-in-out z-50 border-b-2 border-gray-300 bg-white shadow-md"])},[v(c)],2),r("section",ae,[e[14]||(e[14]=r("h1",{class:"pt-[80px] text-[50px] text-[#6ea589]"},"Catalogue",-1)),r("button",{onClick:e[0]||(e[0]=(...t)=>o.toggleFilters&&o.toggleFilters(...t)),class:"bg-white text-[#6ea589] w-[150px] rounded-sm border-[#6ea589] border py-2"}," Active Filters "),v(W,{name:"fade-slide"},{default:q(()=>[o.showFilters?(g(),f("div",le,[r("div",ie,[r("button",{onClick:e[1]||(e[1]=(...t)=>o.toggleFilters&&o.toggleFilters(...t)),class:"absolute top-2 right-2 text-gray-700 hover:text-red-500 text-xl font-bold"}," âœ• "),r("div",ne,[r("div",ce,[e[10]||(e[10]=r("label",{class:"text-[#6ea589] text-sm mb-1"},"Country:",-1)),h(r("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.tempSelectedCounty=t),class:"py-2 px-4 border border-gray-300 rounded-md focus:border-green-600 w-[350px] cursor-pointer text-lg"},[e[9]||(e[9]=r("option",{value:""},"Select A Country",-1)),(g(!0),f(U,null,L(o.countries,t=>(g(),f("option",{key:t.country_name,value:t.country_name},J(t.country_name),9,ue))),128))],512),[[H,o.tempSelectedCounty]])]),r("div",de,[e[11]||(e[11]=r("label",{class:"text-[#6ea589] text-sm mb-1"},"City:",-1)),h(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.tempCity=t),type:"text",placeholder:"Enter City",class:"py-2 px-4 border border-gray-300 rounded-md focus:border-green-600 w-[355px] p-2 cursor-pointer text-lg"},null,512),[[P,o.tempCity]])]),r("div",pe,[r("div",me,[r("div",ge,[e[12]||(e[12]=r("label",{class:"text-[#6ea589] text-sm mb-1"},"From Price:",-1)),h(r("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.tempFromPrice=t),type:"number",placeholder:"Min price",class:"py-2 px-4 border border-gray-300 rounded-md focus:border-green-600 w-[350px] p-2 cursor-pointer text-lg"},null,512),[[P,o.tempFromPrice]])]),r("div",fe,[e[13]||(e[13]=r("label",{class:"text-[#6ea589] text-sm mb-1"},"To Price:",-1)),h(r("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.tempToPrice=t),type:"number",placeholder:"Max price",class:"py-2 px-4 border border-gray-300 rounded-md focus:border-green-600 w-[355px] p-2 cursor-pointer text-lg"},null,512),[[P,o.tempToPrice]])])])])]),r("div",_e,[r("button",{onClick:e[6]||(e[6]=(...t)=>o.resetFilter&&o.resetFilter(...t)),class:"bg-[#6ea589] mr-2 text-white px-6 py-2 rounded-sm shadow-md hover:bg-[#5b8f73] transition-all w-full md:w-auto"}," Clear "),r("button",{onClick:e[7]||(e[7]=(...t)=>o.applyFilters&&o.applyFilters(...t)),class:"bg-[#6ea589] text-white px-6 py-2 rounded-sm shadow-md hover:bg-[#5b8f73] transition-all w-full md:w-auto"}," Apply Filters ")])])])):K("",!0)]),_:1})]),r("section",ye,[o.paginatedListings.length>0?(g(),f("div",xe,[r("div",ve,[(g(!0),f(U,null,L(o.paginatedListings,t=>(g(),O(i,{key:t.item_code,title:t.custom_title,address:t.custom_location,location:t.custom_city,country:t.custom_country,price:t.price_list_rate?`${t.price_list_rate}`:"N/A",currency:t.currency,imageUrl:o.getImageUrl(t.custom_profile_picture),onClick:_=>o.goToBookingPage(t)},null,8,["title","address","location","country","price","currency","imageUrl","onClick"]))),128))]),r("div",be,[v(s,{page:o.page,"onUpdate:page":e[8]||(e[8]=t=>o.page=t),"page-count":o.totalPages},null,8,["page","page-count"])])])):(g(),f("div",he,e[15]||(e[15]=[r("p",{class:"text-gray-600 text-lg sm:text-xl font-medium"},"No properties available at the moment.",-1),r("p",{class:"text-gray-500 text-sm sm:text-base"},"Try adjusting your search filters or check back later.",-1)])))]),v(n)])}const Le=D(re,[["render",Ce]]);export{Le as default};
