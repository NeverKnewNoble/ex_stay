var p=(i,o,a)=>new Promise((n,c)=>{var s=r=>{try{d(a.next(r))}catch(t){c(t)}},_=r=>{try{d(a.throw(r))}catch(t){c(t)}},d=r=>r.done?n(r.value):Promise.resolve(r.value).then(s,_);d((a=a.apply(i,o)).next())});import{r as x,M as h,_ as b,c as y,o as k,a as u,d as g,b as e,m as v,T as B,F as C,e as M,s as N,g as f,h as m,i as F,l as w,t as l,f as T,B as P}from"./index-Db7eiPIg.js";import{N as A,F as E}from"./footer-jK3drDvy.js";import"./axios-Bn511Lua.js";function R(){const i=x(null),o=x(null),a=h({method:"post",url:"/api/method/frappe.client.get_list",params:{doctype:"Ex Bookings",fields:["name","email","status","country","location","city","check_in","check_out","guests","price_per_night","no_of_nights","profile_picture_import","title","currency"],limit_page_length:100}}),n=()=>p(this,null,function*(){try{console.log("Fetching bookings...");const s=yield a.fetch();return console.log("✅ Raw API Response:",s),Array.isArray(s)?(console.log("✅ Fetched bookings:",s),s):(console.warn("⚠️ Unexpected response format:",s),[])}catch(s){return console.error("🚨 Unable to fetch bookings:",s),[]}}),c=h({url:"ex_stay.api.cancel_booking.cancel_booking",makeParams(s){return{name:s}},onSuccess(s){i.value="Booking Cancelled successfully.",o.value="success",n()},onError(s){i.value="An error occurred while cancelling your booking.",o.value="error"}});return{FetchMyBookings:n,cancelMyBooking:c,alertType:o,alertMessage:i}}const V={components:{Navbar:A,FooterComponent:E},setup(){const{FetchMyBookings:i,cancelMyBooking:o,alertMessage:a,alertType:n}=R(),c=x([]),s=x(!0),_=y(()=>N.user||"");k(()=>p(this,null,function*(){s.value=!0,c.value=yield i(),s.value=!1}));const d=y(()=>c.value.filter(r=>r.email===_.value));return{bookings:c,filteredBookings:d,loading:s,userEmail:_,alertMessage:a,alertType:n,cancelMyBooking:o}}},j={class:"min-h-screen bg-gray-100 flex flex-col"},z={class:"fixed top-20 right-5 z-50 w-100"},I={class:"flex-grow pt-20 pb-8"},L={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},S={class:"bg-white shadow-lg rounded-lg overflow-hidden"},U={class:"p-6"},D={key:0,class:"text-center text-gray-500"},G={key:1,class:"text-center text-gray-500"},q={key:2},H=["src"],J={class:"flex-grow w-full"},K={class:"flex flex-col md:flex-row justify-between items-start"},O={class:"w-full"},Q={class:"text-xl font-semibold text-gray-500 mb-2"},W={class:"text-xl font-semibold"},X={class:"text-gray-600"},Y={class:"text-gray-700 mt-2"},Z={class:"text-gray-700"},$={class:"text-gray-700"},ee={class:"text-gray-700"},te={class:"flex flex-col md:flex-row items-center gap-4 mt-4 md:mt-0 w-full"},se=["onClick"],oe={class:"mt-4 flex justify-end md:text-right text-center"},ne={class:"text-gray-600 text-sm"},le={class:"font-semibold text-[18px] md:text-[20px]"},re={class:"text-green-600 text-lg font-semibold pt-3"};function ae(i,o,a,n,c,s){const _=f("Navbar"),d=f("n-alert"),r=f("FooterComponent");return m(),u("div",j,[g(_,{class:"shadow-md"}),e("div",z,[g(B,{name:"fade"},{default:v(()=>[n.alertMessage?(m(),F(d,{key:0,type:n.alertType,closable:"",onClose:o[0]||(o[0]=t=>n.alertMessage=null)},{default:v(()=>[w(l(n.alertMessage),1)]),_:1},8,["type"])):T("",!0)]),_:1})]),e("main",I,[e("div",L,[e("div",S,[o[3]||(o[3]=e("div",{class:"p-6 bg-green-600 text-white"},[e("h1",{class:"text-2xl font-semibold"},"My Bookings")],-1)),e("div",U,[n.loading?(m(),u("div",D,"Loading bookings...")):n.filteredBookings.length===0?(m(),u("div",G,o[1]||(o[1]=[e("p",null,"No bookings found.",-1)]))):(m(),u("div",q,[(m(!0),u(C,null,M(n.filteredBookings,t=>(m(),u("div",{key:t.name,class:"mb-6 border-b pb-6 last:border-b-0 flex flex-col md:flex-row items-center md:items-start gap-6"},[e("img",{src:t.profile_picture_import,alt:"Property Image",class:"w-full max-w-[200px] h-[200px] object-cover rounded-lg shadow-sm border"},null,8,H),e("div",J,[e("div",K,[e("div",O,[e("h2",Q,l(t.name),1),e("h2",W,l(t.title),1),e("p",X,l(t.country)+" | "+l(t.city)+" | "+l(t.location),1),e("p",Y,"Guests: "+l(t.guests),1),e("p",Z,"Check-in: "+l(t.check_in),1),e("p",$,"Check-out: "+l(t.check_out),1),e("p",ee,"Nights: "+l(t.no_of_nights),1)]),e("div",te,[e("span",{class:P([{"text-green-800 bg-green-400 rounded-full text-sm py-2 px-4":t.status==="Confirmed","text-yellow-800 bg-yellow-400 rounded-full text-sm py-2 px-4":t.status==="Pending","text-red-800 bg-red-400 rounded-full text-sm py-2 px-4":t.status==="Cancelled"},"font-semibold text-xs md:text-sm w-full text-center"])},l(t.status),3),e("button",{onClick:ce=>n.cancelMyBooking.submit(t.name),class:"bg-red-500 text-white px-2 py-2 rounded-lg text-xs md:text-sm font-semibold hover:bg-red-600 w-full text-center"},l(n.loading?"Cancelling...":"Cancel"),9,se)])]),e("div",oe,[e("div",null,[e("p",ne,[e("span",le,l(t.currency)+" "+l(t.price_per_night),1),o[2]||(o[2]=w(" night "))]),e("p",re," Total Price: "+l(t.currency)+" "+l(Number(t.price_per_night)*Number(t.no_of_nights)),1)])])])]))),128))]))])])])]),g(r,{class:"mt-auto"})])}const ue=b(V,[["render",ae]]);export{ue as default};
